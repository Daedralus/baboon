<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Disney Princess Day — Paris Reveal</title>
<style>
  :root{ --bg:#fff7f4; --card:#ffffffe6; --accent:#c83a3a }
  html,body{height:100%;}
  body { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; padding:24px; display:flex; align-items:center; justify-content:center; background:var(--bg); color:#222 }
  .frame{ width:100%; max-width:480px; background:transparent; border-radius:12px; overflow:hidden; box-shadow:0 12px 30px rgba(20,10,8,0.08); display:flex; flex-direction:column; height:100vh; max-height:800px; }
  .map-wrap{ position:relative; background:transparent; flex-shrink:0; }
  .image-container{ position:relative; width:100%; height:auto; min-height:200px; background:#f8f8f8; border-radius:8px; overflow:hidden; }
  #map { display:block; width:100%; height:auto; border-radius:8px; transition: opacity 0.5s ease; position:relative; z-index:1; }
  .photo-indicator{ position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.7); color:white; padding:4px 8px; border-radius:12px; font-size:0.8rem; z-index:2; }

  .content{ padding:18px; background:transparent; flex:1; overflow-y:auto; max-height:300px; }
  .card{ background:var(--card); border-radius:10px; padding:14px 16px; margin:12px 0; box-shadow:0 6px 18px rgba(30,15,10,0.06); opacity:0; transform:translateY(8px); transition:all 420ms ease; }
  .card.show{ opacity:1; transform:none; }
  .card.current{ border-left:3px solid var(--accent); }
  .card.previous{ opacity:0.6; background:rgba(255,255,255,0.4); }
  .stage-title{ font-weight:600; margin-bottom:6px; }
  .small{ font-size:0.92rem; color:#444 }
  #intro .stage-title{ cursor:pointer; user-select:none; transition: all 300ms ease; }
  .controls{ display:flex; gap:8px; justify-content:center; padding:12px; }
  button{ background:#fff; border:1px solid #eee; padding:10px 14px; border-radius:9px; font-weight:600; cursor:pointer }
  button.primary{ background:var(--accent); color:white; border:none }
  
  /* Mobile optimizations */
  @media (max-width: 480px) {
    body { padding: 8px; }
    .frame { 
      max-width: 100%; 
      height: 100vh; 
      max-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .map-wrap {
      flex-shrink: 0;
      height: auto;
      min-height: 200px;
      max-height: 280px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .image-container {
      width: 100%;
      height: 280px; /* Smaller fixed height */
      min-height: 280px;
      max-height: 280px;
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    #map {
      width: auto;
      max-width: 100%;
      height: auto;
      max-height: 100%;
      object-fit: contain;
      border-radius: 4px;
    }
    
    /* Force consistent size for all path images */
    #map {
      max-height: 260px !important;
      width: auto !important;
      object-fit: contain !important;
    }
    
    .photo-indicator {
      font-size: 0.75rem;
      padding: 3px 6px;
      top: 8px;
      right: 8px;
    }
    
    .content {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      max-height: calc(100vh - 330px); /* Adjusted for smaller image container */
    }
    
    .controls {
      flex-direction: column;
      gap: 10px;
      padding: 12px;
      flex-shrink: 0;
    }
    
    button {
      width: 100%;
      padding: 12px 16px;
      font-size: 0.9rem;
    }
  }
  
  @media (max-width: 375px) {
    .frame { 
      margin: 0;
      height: 100vh;
    }
    
    .map-wrap {
      max-height: 280px;
    }
    
    .image-container {
      height: 280px;
      min-height: 280px;
      max-height: 280px;
    }
    
    #map {
      max-height: 100%; /* Use container height */
    }
    
    .content {
      max-height: calc(100vh - 350px);
    }
  }

</style>
</head>
<body>
  <div class="frame" role="main">
    <div class="map-wrap">
      <div class="image-container">
        <img id="map" src="photos/CH/cheeseE.jpg" alt="Paris travel path map">
        <div class="photo-indicator" id="photoIndicator">Path 1/8</div>
      </div>
    </div>

    <div class="content" id="contentArea">
      <div class="card show" id="intro">
        <div class="stage-title">Paris Tedventure</div>
        <div class="small">This page incorporates baguette magic to update in real time - I hope you enjoy today lots! I love you so much my disney princess babyboooonnn! (PS: Cute detail at end)</div>
      </div>
    </div>

    <!-- 
    <div class="controls">
      <button id="manualBtn">Reveal Next</button>
      <button id="testBtn">Show All (test)</button>
    </div>
    -->
  </div>

<script>
// Stage data (Paris local times) - ISO with CET offset (+01:00)
const stages = [
  { time: '2025-11-08T10:30:00+01:00', title: 'Croissant Class', note:'10:30 — 12:30', photo: 'Path1.png' },
  { time: '2025-11-08T12:30:00+01:00', title: 'Marais Mini-stroll & Coffee', note:'12:30 — 13:05', photo: 'Path2.png' },
  { time: '2025-11-08T13:30:00+01:00', title: 'Musée Vivant du Fromage — Île Saint-Louis', note:'13:30 — 15:00', photo: 'Path3.png' },
  { time: '2025-11-08T15:00:00+01:00', title: 'Notre Dame Walk', note:'15:00 — 15:45', photo: 'Path4.png' },
  { time: '2025-11-08T15:40:00+01:00', title: 'To The Boat!', note:'15:45-16:30', photo: 'Path4.png' },
  { time: '2025-11-08T16:30:00+01:00', title: 'Eiffel Arrival — Golden Hour + Shopping', note:'16:30-19:00', photo: 'Path5.png' },
  { time: '2025-11-08T19:00:00+01:00', title: 'Dinner at Le Petit Cler', note:'19:00-21:00', photo: 'Path6.png' },
  { time: '2025-11-08T21:00:00+01:00', title: 'End of Day', note:'21:00-00:00', photo: 'Path7.png' }
];

let revealed = -1;
const content = document.getElementById('contentArea');
const manualBtn = document.getElementById('manualBtn');
const testBtn = document.getElementById('testBtn');
const mapImg = document.getElementById('map');
const photoIndicator = document.getElementById('photoIndicator');

// Initialize with first photo
mapImg.src = 'photos/CH/cheeseE.jpg';
mapImg.alt = 'Croissant class - Travel path map';
photoIndicator.textContent = 'Path 1/8';

// Helper: get current Paris time as a Date object
function nowInParis(){
  try{
    const fmt = new Intl.DateTimeFormat('en-GB', { timeZone: 'Europe/Paris', year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false });
    const parts = fmt.formatToParts(new Date());
    const map = {};
    parts.forEach(p=> map[p.type]=p.value);
    const iso = `${map.year}-${map.month}-${map.day}T${map.hour}:${map.minute}:${map.second}+01:00`;
    return new Date(iso);
  }catch(e){
    // fallback to local time (best-effort)
    return new Date();
  }
}

function createCard(stageIndex){
  const s = stages[stageIndex];
  const card = document.createElement('div');
  card.className='card show current';
  const title = document.createElement('div'); title.className='stage-title'; title.textContent = s.title;
  const note = document.createElement('div'); note.className='small'; note.textContent = s.note;
  card.appendChild(title); card.appendChild(note);
  
  // Gray out all existing stage cards
  document.querySelectorAll('.card.current').forEach(c => {
    c.classList.remove('current');
    c.classList.add('previous');
  });
  
  // Insert at second position (after intro)
  if (content.children.length > 1) {
    content.insertBefore(card, content.children[1]);
  } else {
    content.appendChild(card);
  }
  
  // Update map photo to current stage
  updateMapPhoto(stageIndex);
}

function updateMapPhoto(stageIndex) {
  const s = stages[stageIndex];
  if (s.photo) {
    mapImg.style.opacity = '0.5';
    setTimeout(() => {
      mapImg.src = `photos/paris/${s.photo}`;
      mapImg.alt = `${s.title} - Travel path map`;
      photoIndicator.textContent = `Path ${stageIndex + 1}/8`;
      
      // Force maintain proper styling after image swap
      mapImg.style.width = 'auto';
      mapImg.style.maxWidth = '100%';
      mapImg.style.height = 'auto';
      mapImg.style.maxHeight = '100%';
      mapImg.style.objectFit = 'contain';
      mapImg.style.display = 'block';
      mapImg.style.opacity = '1';
      
      // Ensure the map stays visible (scroll to top of page if needed)
      if (window.scrollY > 100) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }, 250);
  }
}

function checkAuto(){
  const now = nowInParis();
  for(let i=0;i<stages.length;i++){
    const t = new Date(stages[i].time);
    if(now >= t && i > revealed){
      revealed = i;
      createCard(i);
    }
  }
}

// Hold title for 5 seconds to reveal next
let holdTimer = null;
const titleEl = document.querySelector('#intro .stage-title');

titleEl.addEventListener('touchstart', startHold);
titleEl.addEventListener('mousedown', startHold);
titleEl.addEventListener('touchend', cancelHold);
titleEl.addEventListener('mouseup', cancelHold);
titleEl.addEventListener('touchcancel', cancelHold);
titleEl.addEventListener('mouseleave', cancelHold);

function startHold(e) {
  e.preventDefault();
  titleEl.style.opacity = '0.6';
  titleEl.style.transform = 'scale(0.95)';
  holdTimer = setTimeout(() => {
    const next = Math.min(revealed+1, stages.length-1);
    if(next > revealed){ 
      revealed = next; 
      createCard(next); 
    }
    titleEl.style.opacity = '1';
    titleEl.style.transform = 'scale(1)';
  }, 5000);
}

function cancelHold() {
  titleEl.style.opacity = '1';
  titleEl.style.transform = 'scale(1)';
  if (holdTimer) {
    clearTimeout(holdTimer);
    holdTimer = null;
  }
}

// initial run: show intro then run auto-check every 10s
checkAuto();
setInterval(checkAuto, 10000);
</script>
</body>
</html>
